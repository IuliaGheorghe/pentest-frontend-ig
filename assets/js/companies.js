// Array of objects with all companies info

let companies = [
    {
        name: "Allianz",
        industry: "Banking & Finance",
        country: "Germany",
        relevance: 7,
        image: "assets/media/images/companies-logos/Allianz-Logo.wine.svg",
    },
    {
        name: "Cathay United Bank",
        industry: "Banking & Finance",
        country: "China",
        relevance: 1,
        image: "assets/media/images/companies-logos/Cathay_United_Bank_logo.svg"
    },
    {
        name: "Yale University",
        industry: "Education",
        country: "United States of America",
        relevance: 10,
        image: "assets/media/images/companies-logos/Yale_University_logo.svg"

    },
    {
        name: "Johnson & Johnson",
        industry: "Healthcare",
        country: "United Kingdom",
        relevance: 8,
        image: "assets/media/images/companies-logos/Johnson_and_Johnson_Logo.svg"

    },
    {
        name: "Accenture",
        industry: "Audit & Advisory",
        country: "United Kingdom",
        relevance: 7,
        image: "assets/media/images/companies-logos/Accenture.svg"

    },
    {
        name: "Deloitte",
        industry: "Audit & Advisory",
        country: "United Kingdom",
        relevance: 7,
        image: "assets/media/images/companies-logos/Deloitte.svg"

    },
    {
        name: "Intel",
        industry: "Technology & Telecom",
        country: "United States of America",
        relevance: 10,
        image: "assets/media/images/companies-logos/Intel_logo_(2006-2020).svg"

    },
    {
        name: "Orange",
        industry: "Technology & Telecom",
        country: "France",
        relevance: 9,
        image: "assets/media/images/companies-logos/Orange_logo.svg"

    },
    {
        name: "Vodafone",
        industry: "Technology & Telecom",
        country: "United Kingdom",
        relevance: 9,
        image: "assets/media/images/companies-logos/Vodafone_2017_logo.svg"

    },
    {
        name: "U.S. Department of Commerce",
        industry: "Gov & Public Sector",
        country: "United States of America",
        relevance: 10,
        image: "assets/media/images/companies-logos/Seal_of_the_United_States_Department_of_Commerce.svg"
    }
]


let showFilter = document.getElementById("show-filter");
let resetFilters = document.getElementById("reset-filters");

let filterContainer = document.getElementById("filters");

// ORDER BY element and it's value
let orderEl = document.getElementById("order");
let order = orderEl.value;

// ascending or descending (ORDER BY mode)
let modeEl = document.getElementById("mode").getElementsByTagName("i")[0];

// COUNTRY element and it's value (visible after clicking on filters)
let countryEl = document.getElementById("country");
let country = countryEl.value;

// INDUSTRY element and it's value (visible after clicking on filters)
let industryEl = document.getElementById("industry");
let industry = industryEl.value;


let result = document.getElementById("results");


orderEl.addEventListener("change", showCompanies);
countryEl.addEventListener("change", showCompanies);
industryEl.addEventListener("change", showCompanies);
modeEl.addEventListener("click", changeMode);


showFilter.addEventListener("click", filterContainerDisplay);

function filterContainerDisplay(){

    // If filters are visible, hide else show

    if(filterContainer.style.display === "flex")
        filterContainer.style.display = "none";
    else
        filterContainer.style.display = "flex";
}

resetFilters.addEventListener("click", resetFiltersFunc)

function resetFiltersFunc(){
    // change filters values to default values and show companies  

    countryEl.value = "All countries";
    industryEl.value = "All industries";
    showCompanies();
}


// Ascending vs Descending functions (will change font awesome icon and modify results in container )


function changeMode(){
    if(modeEl.classList.contains("fa-arrow-down-short-wide"))
        {
            modeEl.classList.remove("fa-arrow-down-short-wide"); 
            modeEl.classList.add("fa-arrow-up-short-wide"); 
        }
    else
        {
            modeEl.classList.remove("fa-arrow-up-short-wide"); 
            modeEl.classList.add("fa-arrow-down-short-wide");
        }
    
    showCompanies();
}

function checkMode(){
    if (modeEl.classList.contains("fa-arrow-down-short-wide"))
        return "descending";
    else
        return "ascending";
}

// Filters Results By Country and Industry

function filterResults(country, industry){

    let results = new Array();

    // depending on the values of country and industry (which are modified depending on user selections) the companies with matching values will be pushed to an array which will be returned

    for(let i = 0; i< companies.length; i++)
        if(companies[i].country === country || country === "All countries")
            if(companies[i].industry === industry || industry === "All industries")
                results.push(companies[i]);

    return results;
}

function sortCompanies(results, order, mode){

    
    if(order==="Default" || order === "Relevance"){

        if(mode === "descending")
            results.sort(function(a, b){return b.relevance-a.relevance});
        else     
            results.sort(function(a, b){return a.relevance-b.relevance});

    }

    else if(order === "Alphabetical"){
        results.sort();

        if(mode === "descending")
            results.reverse();

        }

    return results;

}


function showCompanies(country, industry, order){

    order = orderEl.value;
    country = countryEl.value;
    industry = industryEl.value;
    mode = checkMode();


    resultsToDisplay = filterResults(country, industry);

    // If we have results to show to the user, we use an HTML template to show them, else we type "No Match!"


    if(resultsToDisplay.length){
        result.innerHTML = "";
        let sortedResults = sortCompanies(resultsToDisplay, order, mode);

        for(let i = 0 ; i< sortedResults.length; i++)
            result.innerHTML += '<img src="' + sortedResults[i].image  + '" alt="' + sortedResults[i].name +  '" title="' + sortedResults[i].name + ' is a Pentest-Tools.com customer"  />';
    }
    else
        result.innerHTML = "No Match!";
}

showCompanies("All countries", "All industries", "Default");